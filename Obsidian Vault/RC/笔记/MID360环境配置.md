https://blog.csdn.net/2301_78200883/article/details/147306064
[大疆Livox Mid360 使用指南-阿里云开发者社区](https://developer.aliyun.com/article/1592459)
[固态雷达Livox Mid-360进行配置并读取雷达数据(含外参) - 知乎](https://zhuanlan.zhihu.com/p/694345785)

环境：Ubuntu 20.04
## 安装配置Livox-SDK2

https://github.com/Livox-SDK/Livox-SDK2
```
git clone https://github.com/Livox-SDK/Livox-SDK2.git
cd ./Livox-SDK2/
mkdir build
cd build
cmake .. && make -j
sudo make install

```
## 安装配置livox_ros_driver2
https://github.com/Livox-SDK/livox_ros_driver2

### 1. 准备工作
#### 1.1作系统要求

- 适用于 ROS Melodic 的 Ubuntu 18.04;
- Ubuntu 20.04 用于 ROS Noetic 和 ROS2 Foxy;
- Ubuntu 22.04 for ROS2 Humble;

**技巧：**

Colcon 是 ROS2 中使用的构建工具。

如何安装 colcon：[Colcon 安装说明](https://docs.ros.org/en/foxy/Tutorials/Beginner-Client-Libraries/Colcon-Tutorial.html)
#### 1.2 安装 ROS 和 ROS2

ROS2 Foxy 安装请参考：[ROS Foxy 安装说明](https://docs.ros.org/en/foxy/Installation/Ubuntu-Install-Debians.html)

建议使用桌面完整安装。
第一部的区域设置不要执行，不然系统文件就会混乱。

这里安装由于我们之前安装的是noetic版，会造成版本冲突。
在执行
```
source /opt/ros/foxy/setup.bash
```
前，先在`~/.bashrc`中把`source /opt/ros/noetic/setup.bash`注释：

```
# 只在需要时加载 
# source /opt/ros/noetic/setup.bash
```

### 2. 构建并运行 Livox ROS 驱动程序 2

#### 2.1 克隆 Livox ROS Driver 2 源码：

```shell
git clone https://github.com/Livox-SDK/livox_ros_driver2.git ws_livox/src/livox_ros_driver2
```

**注意：**

请务必将源代码克隆在 '[work_space]/src/' 文件夹中（如上图所示），否则会因编译工具限制而出现编译错误。
```
cd ~

mkdir -p livox_ros_driver2/src

cd livox_ros_driver2/src
git clone https://github.com/Livox-SDK/livox_ros_driver2.git 
```
#### 2.2 构建并安装 Livox-SDK2

**注意：**

请按照 [Livox-SDK2/README.md](https://github.com/Livox-SDK/Livox-SDK2/blob/master/README.md) 中的安装指南进行
1. 依赖：

- [CMake 3.0.0+](https://cmake.org/)
- gcc 4.8.1+

1. 使用 apt 安装 **CMake**：

```shell
sudo apt install cmake
```

3. 编译并安装 Livox-SDK2（**这一步在上面已完成，请忽略**）：

```shell
git clone https://github.com/Livox-SDK/Livox-SDK2.git
cd ./Livox-SDK2/
mkdir build
cd build
cmake .. && make -j
sudo make install
```

**注：**生成  
的共享库和静态库安装到“/usr/local/lib”目录下。头文件安装到“/usr/local/include”目录中。

提示：删除 Livox SDK2：

```shell
$ sudo rm -rf /usr/local/lib/liblivox_lidar_sdk_*
$ sudo rm -rf /usr/local/include/livox_lidar_*
```

#### 2.3 构建 Livox ROS 驱动程序 2：
##### 对于 ROS2 Foxy：

```shell
# 在src文件下
cd livox_ros_driver2
source /opt/ros/foxy/setup.sh
./build.sh ROS2
```
在执行`./build.sh ROS2`时，先退出conda环境，检查依赖
```
pip3 install catkin_pkg
pip3 install empy==3.3.4
```
这里编译后提醒为
ROS version is: ROS2
Starting >>> livox_ros_driver2
--- stderr: livox_ros_driver2                              
** WARNING ** io features related to pcap will be disabled
** WARNING ** io features related to png will be disabled
** WARNING ** io features related to libusb-1.0 will be disabled
/usr/include/apr-1.0
apr-1
Finished <<< livox_ros_driver2 [8.88s]

以上warning暂时不处理

#### 2.4 运行 Livox ROS 驱动程序 2：
##### 对于 ROS2：

```shell
source ../../install/setup.sh
ros2 launch livox_ros_driver2 [launch file]
```

其中，

- **[启动文件]** ：是您要使用的 ROS2 启动文件;“launch_ROS2”文件夹包含多个启动示例供您参考。

HAP LiDAR 的 rviz 启动示例是：

```shell
ros2 launch livox_ros_driver2 rviz_HAP_launch.py
```


### 3. 启动文件并livox_ros_driver2内部参数配置说明
#### 3.1 启动文件配置说明

ROS2 的启动文件位于“ws_livox/src/livox_ros_driver2/launch_ROS2”目录下。不同的启动文件具有不同的配置参数值，并且在不同的场景中使用：

| 启动文件名              | 描述                                                               |     |
| ------------------ | ---------------------------------------------------------------- | --- |
| rviz_HAP.launch    | 连接HAP LiDAR设备  <br>发布pointcloud2格式数据  <br>自动加载rviz               |     |
| msg_HAP.launch     | 连接HAP LiDAR设备  <br>发布livox定制点云数据                                 |     |
| rviz_MID360.launch | 连接 MID360 LiDAR 设备  <br>发布 pointcloud2 格式数据  <br>自动加载 rviz       |     |
| msg_MID360.launch  | 连接 MID360 LiDAR 设备  <br>发布 livox 定制点云数据                          |     |
| rviz_mixed.launch  | 连接 HAP 和 MID360 LiDAR 设备  <br>发布 pointcloud2 格式数据  <br>自动加载 rviz |     |
| msg_mixed.launch   | 连接HAP和MID360激光雷达设备  <br>发布livox定制点云数据                            |     |

#### 3.2 Livox ros 驱动 2 内部主参数配置说明


Livox_ros_driver2的所有内部参数都在启动文件中。以下是三个常用参数的详细说明：

| 参数           | 详细说明                                                                                                                             | 默认   |
| ------------ | -------------------------------------------------------------------------------------------------------------------------------- | ---- |
| publish_freq | 设置点云发布  <br>频率浮点数据类型，推荐值5.0、10.0、20.0、50.0等。最大发布频率为 100.0 Hz。                                                                    | 10.0 |
| multi_topic  | 如果激光雷达设备有独立的主题发布点云数据  <br>0 -- 所有激光雷达设备使用相同的主题发布点云数据  <br>1 -- 每个激光雷达设备都有自己的主题发布点云数据                                             | 0    |
| xfer_format  | 设置点云格式  <br>0 -- Livox 点云 2（PointXYZRTLT） 点云格式  <br>1 -- Livox 自定义点云格式  <br>2 -- PCL 库中的标准点云 2 （pcl ：： PointXYZI） 点云格式（仅适用于 ROS） | 0    |

**注意：**

除非完全理解，否则不建议更改本表中未提及的其他参数。

_**Livox_ros_driver2 点云数据详细说明：**_

1. Livox pointcloud2 （PointXYZRTLT） 点云格式，如下所示：

```c
float32 x               # X axis, unit:m
float32 y               # Y axis, unit:m
float32 z               # Z axis, unit:m
float32 intensity       # the value is reflectivity, 0.0~255.0
uint8   tag             # livox tag
uint8   line            # laser number in lidar
float64 timestamp       # Timestamp of point
```

**注意：**

帧中的点数可能不同，但每个点都提供时间戳。

2. Livox 定制数据包格式，如下：

```c
std_msgs/Header header     # ROS standard message header
uint64          timebase   # The time of first point
uint32          point_num  # Total number of pointclouds
uint8           lidar_id   # Lidar device id number
uint8[3]        rsvd       # Reserved use
CustomPoint[]   points     # Pointcloud data
```

上述定制数据包中的定制点云（CustomPoint）格式：

```c
uint32  offset_time     # offset time relative to the base time
float32 x               # X axis, unit:m
float32 y               # Y axis, unit:m
float32 z               # Z axis, unit:m
uint8   reflectivity    # reflectivity, 0~255
uint8   tag             # livox tag
uint8   line            # laser number in lidar
```

3. PCL 库中的标准 pointcloud2 （pcl ：： PointXYZI） 格式（仅 ROS 可以发布）：

请参考 PCL 库的 point_types.hpp 文件中的 pcl ：： PointXYZI 数据结构。

### 4. 激光雷达配置

LiDAR 配置（例如 ip、端口、数据类型......等等）可以通过 JSON 样式的配置文件进行设置。单个 HAP、Mid360 和混合激光雷达的配置文件位于“config”文件夹中。启动文件中的参数命名_“user_config_path”_指示此类 json 文件路径。

1. 以下是 HAP LiDAR 的配置示例（位于 config/HAP_config.json 中）：

```json
{
  "lidar_summary_info" : {
    "lidar_type": 8  # protocol type index, please don't revise this value
  },
  "HAP": {
    "device_type" : "HAP",
    "lidar_ipaddr": "",
    "lidar_net_info" : {
      "cmd_data_port": 56000,  # command port
      "push_msg_port": 0,
      "point_data_port": 57000,
      "imu_data_port": 58000,
      "log_data_port": 59000
    },
    "host_net_info" : {
      "cmd_data_ip" : "192.168.1.50",  # host ip (it can be revised)
      "cmd_data_port": 56000,
      "push_msg_ip": "",
      "push_msg_port": 0,
      "point_data_ip": "192.168.1.50",  # host ip
      "point_data_port": 57000,
      "imu_data_ip" : "192.168.1.50",  # host ip
      "imu_data_port": 58000,
      "log_data_ip" : "",
      "log_data_port": 59000
    }
  },
  "lidar_configs" : [
    {
      "ip" : "192.168.1.101",  # ip of the LiDAR you want to config
      "pcl_data_type" : 1,
      "pattern_mode" : 0,
      "blind_spot_set" : 50,
      "extrinsic_parameter" : {
        "roll": 0.0,
        "pitch": 0.0,
        "yaw": 0.0,
        "x": 0,
        "y": 0,
        "z": 0
      }
    }
  ]
}
```

上 json 文件中的参数属性如下表所述：

**LiDAR配置参数**

| 参数                             | 类型     | 描述                                                                              | 默认            |
| :----------------------------- | ------ | ------------------------------------------------------------------------------- | ------------- |
| ip                             | String | 您要配置的激光雷达的 IP                                                                   | 192.168.1.100 |
| pcl_data_type                  | Int    | 选择要发送  <br>的点云数据的分辨率 1 -- 笛卡尔坐标数据（32 位）  <br>2 -- 笛卡尔坐标数据（16 位）  <br>3 -- 球坐标数据 | 1             |
| pattern_mode                   | Int    | 空间扫描模式  <br>0 -- 非重复扫描模式模式  <br>1 -- 重复扫描模式模式  <br>2 -- 重复扫描模式模式（低扫描速率）         | 0             |
| blind_spot_set（仅适用于 HAP LiDAR） | Int    | 设置盲点  <br>范围从50厘米到200厘米                                                         | 50            |
| extrinsic_parameter            |        | 设置外在参数  <br>“roll”、“picth”、“yaw”的数据类型为 float  <br>“x”、“y”、“z” 的数据类型为 int        |               |

有关 HAP 配置的更多信息，请参阅：[HAP 配置文件说明](https://github.com/Livox-SDK/Livox-SDK2/wiki/hap-config-file-description)

2. 连接多个激光雷达时，将不同激光雷达对应的对象添加到“lidar_configs”阵列中。混合激光雷达配置文件内容示例如下：

```json
{
  "lidar_summary_info" : {
    "lidar_type": 8  # protocol type index, please don't revise this value
  },
  "HAP": {
    "lidar_net_info" : {  # HAP ports, please don't revise these values
      "cmd_data_port": 56000,  # HAP command port
      "push_msg_port": 0,
      "point_data_port": 57000,
      "imu_data_port": 58000,
      "log_data_port": 59000
    },
    "host_net_info" : {
      "cmd_data_ip" : "192.168.1.5",  # host ip
      "cmd_data_port": 56000,
      "push_msg_ip": "",
      "push_msg_port": 0,
      "point_data_ip": "192.168.1.5",  # host ip
      "point_data_port": 57000,
      "imu_data_ip" : "192.168.1.5",  # host ip
      "imu_data_port": 58000,
      "log_data_ip" : "",
      "log_data_port": 59000
    }
  },
  "MID360": {
    "lidar_net_info" : {  # Mid360 ports, please don't revise these values
      "cmd_data_port": 56100,  # Mid360 command port
      "push_msg_port": 56200,
      "point_data_port": 56300,
      "imu_data_port": 56400,
      "log_data_port": 56500
    },
    "host_net_info" : {
      "cmd_data_ip" : "192.168.1.5",  # host ip
      "cmd_data_port": 56101,
      "push_msg_ip": "192.168.1.5",  # host ip
      "push_msg_port": 56201,
      "point_data_ip": "192.168.1.5",  # host ip
      "point_data_port": 56301,
      "imu_data_ip" : "192.168.1.5",  # host ip
      "imu_data_port": 56401,
      "log_data_ip" : "",
      "log_data_port": 56501
    }
  },
  "lidar_configs" : [
    {
      "ip" : "192.168.1.100",  # ip of the HAP you want to config
      "pcl_data_type" : 1,
      "pattern_mode" : 0,
      "blind_spot_set" : 50,
      "extrinsic_parameter" : {
        "roll": 0.0,
        "pitch": 0.0,
        "yaw": 0.0,
        "x": 0,
        "y": 0,
        "z": 0
      }
    },
    {
      "ip" : "192.168.1.12",  # ip of the Mid360 you want to config
      "pcl_data_type" : 1,
      "pattern_mode" : 0,
      "extrinsic_parameter" : {
        "roll": 0.0,
        "pitch": 0.0,
        "yaw": 0.0,
        "x": 0,
        "y": 0,
        "z": 0
      }
    }
  ]
}
```

3. 当主机上的多个网卡连接到多个激光雷达时，您需要将不同激光雷达对应的对象添加到lidar_configs阵列中。分别运行不同的 luanch 文件，以下是混合激光雷达配置文件内容的示例：

**MID360_config1：**

```json
{
  "lidar_summary_info" : {
    "lidar_type": 8  # protocol type index，please don't revise this value
  },
    "MID360": {
        "lidar_net_info": {
            "cmd_data_port": 56100, # command port
            "push_msg_port": 56200, 
            "point_data_port": 56300,
            "imu_data_port": 56400,
            "log_data_port": 56500
        },
        "host_net_info": [
            {
                "lidar_ip": ["192.168.1.101"], # Lidar ip
                "host_ip": "192.168.1.5", # host ip
                "cmd_data_port": 56101,
                "push_msg_port": 56201,
                "point_data_port": 56301,
                "imu_data_port": 56401,
                "log_data_port": 56501
            }
        ]
    },
    "lidar_configs": [
        {
            "ip": "192.168.1.101", # ip of the LiDAR you want to config
            "pcl_data_type": 1,
            "pattern_mode": 0,
            "extrinsic_parameter": {
                "roll": 0.0,
                "pitch": 0.0,
                "yaw": 0.0,
                "x": 0,
                "y": 0,
                "z": 0
            }
        }
    ]
}
```

**MID360_config2：**

```json
{
  "lidar_summary_info" : {
    "lidar_type": 8  # protocol type index，please don't revise this value
  },
    "MID360": {
        "lidar_net_info": {
            "cmd_data_port": 56100, # command port
            "push_msg_port": 56200, 
            "point_data_port": 56300,
            "imu_data_port": 56400,
            "log_data_port": 56500
        },
        "host_net_info": [
            {
                "lidar_ip": ["192.168.2.100"], # Lidar ip
                "host_ip": "192.168.2.5", # host ip
                "cmd_data_port": 56101,
                "push_msg_port": 56201,
                "point_data_port": 56301,
                "imu_data_port": 56401,
                "log_data_port": 56501
            }
        ]source ../../install/setup.sh
    },
    "lidar_configs": [
        {
            "ip": "192.168.2.100", # ip of the LiDAR you want to config
            "pcl_data_type": 1,
            "pattern_mode": 0,
            "extrinsic_parameter": {
                "roll": 0.0,
                "pitch": 0.0,
                "yaw": 0.0,
                "x": 0,
                "y": 0,
                "z": 0
            }
        }
    ]
}
```

**启动1：**

```
<launch>
    <!--user configure parameters for ros start-->
    <arg name="lvx_file_path" default="livox_test.lvx"/>
    <arg name="bd_list" default="100000000000000"/>
    <arg name="xfer_format" default="0"/>
    <arg name="multi_topic" default="1"/>
    <arg name="data_src" default="0"/>
    <arg name="publish_freq" default="10.0"/>
    <arg name="output_type" default="0"/>
    <arg name="rviz_enable" default="true"/>
    <arg name="rosbag_enable" default="false"/>
    <arg name="cmdline_arg" default="$(arg bd_list)"/>
    <arg name="msg_frame_id" default="livox_frame"/>
    <arg name="lidar_bag" default="true"/>
    <arg name="imu_bag" default="true"/>
    <!--user configure parameters for ros end--> 

    <param name="xfer_format" value="$(arg xfer_format)"/>
    <param name="multi_topic" value="$(arg multi_topic)"/>
    <param name="data_src" value="$(arg data_src)"/>
    <param name="publish_freq" type="double" value="$(arg publish_freq)"/>
    <param name="output_data_type" value="$(arg output_type)"/>
    <param name="cmdline_str" type="string" value="$(arg bd_list)"/>
    <param name="cmdline_file_path" type="string" value="$(arg lvx_file_path)"/>
    <param name="user_config_path" type="string" value="$(find livox_ros_driver2)/config/MID360_config1.json"/> # Mid360 MID360_config1 name
    <param name="frame_id" type="string" value="$(arg msg_frame_id)"/>
    <param name="enable_lidar_bag" type="bool" value="$(arg lidar_bag)"/>
    <param name="enable_imu_bag" type="bool" value="$(arg imu_bag)"/>

    <node name="livox_lidar_publisher1" pkg="livox_ros_driver2"
          type="livox_ros_driver2_node" required="true"
          output="screen" args="$(arg cmdline_arg)"/>

    <group if="$(arg rviz_enable)">
        <node name="livox_rviz" pkg="rviz" type="rviz" respawn="true"
                args="-d $(find livox_ros_driver2)/config/display_point_cloud_ROS1.rviz"/>
    </group>

    <group if="$(arg rosbag_enable)">
        <node pkg="rosbag" type="record" name="record" output="screen"
                args="-a"/>
    </group>

</launch>
```

**启动2：**

```
<launch>
    <!--user configure parameters for ros start-->
    <arg name="lvx_file_path" default="livox_test.lvx"/>
    <arg name="bd_list" default="100000000000000"/>
    <arg name="xfer_format" default="0"/>
    <arg name="multi_topic" default="1"/>
    <arg name="data_src" default="0"/>
    <arg name="publish_freq" default="10.0"/>
    <arg name="output_type" default="0"/>
    <arg name="rviz_enable" default="true"/>
    <arg name="rosbag_enable" default="false"/>
    <arg name="cmdline_arg" default="$(arg bd_list)"/>
    <arg name="msg_frame_id" default="livox_frame"/>
    <arg name="lidar_bag" default="true"/>
    <arg name="imu_bag" default="true"/>
    <!--user configure parameters for ros end--> 

    <param name="xfer_format" value="$(arg xfer_format)"/>
    <param name="multi_topic" value="$(arg multi_topic)"/>
    <param name="data_src" value="$(arg data_src)"/>
    <param name="publish_freq" type="double" value="$(arg publish_freq)"/>
    <param name="output_data_type" value="$(arg output_type)"/>
    <param name="cmdline_str" type="string" value="$(arg bd_list)"/>
    <param name="cmdline_file_path" type="string" value="$(arg lvx_file_path)"/>
    <param name="user_config_path" type="string" value="$(find livox_ros_driver2)/config/MID360_config2.json"/> # Mid360 MID360_config2 name
    <param name="frame_id" type="string" value="$(arg msg_frame_id)"/>
    <param name="enable_lidar_bag" type="bool" value="$(arg lidar_bag)"/>
    <param name="enable_imu_bag" type="bool" value="$(arg imu_bag)"/>

    <node name="livox_lidar_publisher2" pkg="livox_ros_driver2"
          type="livox_ros_driver2_node" required="true"
          output="screen" args="$(arg cmdline_arg)"/>

    <group if="$(arg rviz_enable)">
        <node name="livox_rviz" pkg="rviz" type="rviz" respawn="true"
                args="-d $(find livox_ros_driver2)/config/display_point_cloud_ROS1.rviz"/>
    </group>

    <group if="$(arg rosbag_enable)">
        <node pkg="rosbag" type="record" name="record" output="screen"
                args="-a"/>
    </group>

</launch>

```

### 5. 支持的激光雷达列表

## 可视化软件
https://terra-1-g.djicdn.com/65c028cd298f4669a7f0e40e50ba1131/Mid360/LivoxViewer2%20for%20Ubuntu%20v2.3.0.zip

解压后bash LivoxViewer2.sh
## 雷达与电脑的连接

设置-网络-有线连接，设置ipv4为192.168.1.50
雷达连接电脑，测试是否ping得通，在[ws]/livox_ros_driver2/install/livox_ros_driver2/share/livox_ros_driver2/config/MID360_config.json中对应更改ip地址。

```
ros2 launch livox_ros_driver2 rviz_MID360_launch.py
```

![[2025-09-17 15-35-25 的屏幕截图.png]]